<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIGE - Perfil</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="perfil.css">
</head>

<body>

    <div class="menu-principal">
        <div class="logo-area">
            <img src="Logo_Branca.png" class="logo-menu" alt="Logo">
            <h2>sige</h2>
        </div>

        <i class="fa-solid fa-bars icone-menu hamburguer" id="menu-toggle"></i>

        <div class="menu-icones">
            <i class="fa-solid fa-user icone-menu menu-icon-start"></i>
            <i class="fa-solid fa-right-from-bracket icone-menu"></i>
        </div>
    </div>

    <div class="menu-lateral" id="menu-lateral">
        <nav class="nav-lateral">
            <a href="#"><i class="fa-solid fa-house"></i> Início</a>
            <a href="#"><i class="fa-solid fa-graduation-cap"></i> Turmas</a>
            <a href="#"><i class="fa-solid fa-users"></i> Usuários</a>
            <a href="#"><i class="fa-solid fa-book-open"></i> Disciplinas</a>
        </nav>
    </div>

    <main>
        <div class="titulo">
            <h1>Minhas Informações</h1>
        </div>

        <div class="div-global">
            <div class="area-imagem">
                <img src="images.jpg" alt="Foto de Perfil" class="perfil-imagem" id="imagem-perfil">
                
                <input type="file" id="upload-imagem" accept="image/*" style="display: none;">
                
                <button type="button" class="btn-foto-acao btn-editar-foto" id="btn-foto-opcoes">
                    <i class="fa-solid fa-camera"></i>
                </button>

                <div class="menu-foto" id="menu-foto">
                    <button type="button" id="opcao-alterar">
                        <i class="fa-solid fa-image"></i> Alterar foto
                    </button>
                    <button type="button" id="opcao-remover">
                        <i class="fa-solid fa-trash"></i> Remover foto
                    </button>
                </div>
            </div>

            <hr>

            <form class="formulario perfil-detalhes-form" id="perfil-form">
                <div class="linha-form">
                    <div class="coluna-dado">
                        <label for="nome">Nome Completo</label>
                        <input type="text" name="nome" id="input-nome" value="João Batista do Nascimento Júnior" disabled>
                    </div>
                    <div class="coluna-dado">
                        <label for="matricula">Matrícula</label>
                        <input type="text" name="matricula" value="20241198060000" disabled style="opacity: 0.7;">
                    </div>
                </div>

                <div class="linha-form">
                    <div class="coluna-dado">
                        <label for="cpf">CPF</label>
                        <input type="text" name="cpf" value="502.587.347-09" disabled>
                    </div>
                    <div class="coluna-dado">
                        <label for="email">E-mail Institucional</label>
                        <input type="email" name="email" value="aluno@escola.ifrn.edu.br" disabled>
                    </div>
                </div>

                <div class="linha-form">
                    <div class="coluna-dado">
                        <label for="data_nascimento">Data de Nascimento</label>
                        <input type="date" name="data_nascimento" value="1999-08-16" disabled>
                    </div>
                    <div class="coluna-dado">
                        <label for="telefone">Telefone / WhatsApp</label>
                        <input type="tel" id="telefone-perfil" name="telefone" value="(84) 98103-5313" disabled>
                    </div>
                </div>

                <div class="linha-form">
                    <div class="coluna-dado">
                        <label for="naturalidade">Naturalidade</label>
                        <input type="text" name="naturalidade" value="Natal - RN" disabled>
                    </div>
                    <div class="coluna-dado">
                        <label for="nacionalidade">Nacionalidade</label>
                        <input type="text" name="nacionalidade" value="Brasileira" disabled>
                    </div>
                </div>

                <div class="linha-form">
                    <div class="coluna-dado full-width">
                        <label for="nome_pai">Filiação (Pai)</label>
                        <input type="text" name="nome_pai" value="Nome do Pai" disabled>
                    </div>
                </div>

                <div class="linha-form">
                    <div class="coluna-dado full-width">
                        <label for="nome_mae">Filiação (Mãe)</label>
                        <input type="text" name="nome_mae" value="Nome da Mãe" disabled>
                    </div>
                </div>

                <div class="botoes-crud">
                    <button type="button" class="btn-acao senha">
                        <i class="fa-solid fa-lock"></i> Mudar Senha
                    </button>

                    <button type="button" class="btn-acao editar" id="btn-editar">
                        <i class="fa-solid fa-pen"></i> Editar Dados
                    </button>

                    <button type="submit" class="btn-acao salvar" id="btn-salvar" style="display: none;">
                        <i class="fa-solid fa-check"></i> Salvar
                    </button>

                    <button type="button" class="btn-acao cancelar" id="btn-cancelar" style="display: none;">
                        <i class="fa-solid fa-xmark"></i> Cancelar
                    </button>
                </div>
            </form>
        </div>
    </main>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            
            // --- 1. LÓGICA DO MENU LATERAL ---
            const toggleBtn = document.getElementById("menu-toggle");
            const menuLateral = document.getElementById("menu-lateral");

            toggleBtn.addEventListener("click", () => {
                menuLateral.classList.toggle("ativo");
            });

            // --- 2. LÓGICA DO PERFIL (Formulário e Foto) ---
            const perfilForm = document.getElementById("perfil-form");
            const btnEditar = document.getElementById("btn-editar");
            const btnSalvar = document.getElementById("btn-salvar");
            const btnCancelar = document.getElementById("btn-cancelar");
            const telefoneInput = document.getElementById("telefone-perfil");
            const inputNome = document.getElementById('input-nome');
            const uploadImagemInput = document.getElementById('upload-imagem');
            const imagemPerfil = document.getElementById('imagem-perfil');
            const btnFotoOpcoes = document.getElementById("btn-foto-opcoes");
            const menuFoto = document.getElementById("menu-foto");
            const opcaoAlterar = document.getElementById("opcao-alterar");
            const opcaoRemover = document.getElementById("opcao-remover");
            
            const originalValues = {};
            const editableInputs = perfilForm.querySelectorAll('input:not([name="matricula"]):not([type="submit"])');

            // Máscara de Telefone
            function maskTelefone(event) {
                let v = event.target.value.replace(/\D/g, "");
                if (v.length > 0) v = "(" + v.substring(0, 2) + ") " + v.substring(2);
                if (v.length > 10) v = v.substring(0, 10) + "-" + v.substring(10, 14);
                event.target.value = v;
            }
            telefoneInput.addEventListener("input", maskTelefone);

            // Salva valores originais
            editableInputs.forEach(input => {
                originalValues[input.name] = input.value;
                input.disabled = true;
            });

            // Botão Editar
            btnEditar.onclick = () => {
                editableInputs.forEach(i => i.disabled = false);
                btnEditar.style.display = "none";
                btnSalvar.style.display = "flex";
                btnCancelar.style.display = "flex";
                inputNome.focus();
            };

            // Botão Cancelar
            btnCancelar.onclick = () => {
                editableInputs.forEach(i => i.value = originalValues[i.name]);
                editableInputs.forEach(i => i.disabled = true);
                btnEditar.style.display = "flex";
                btnSalvar.style.display = "none";
                btnCancelar.style.display = "none";
            };

            // Submit
            perfilForm.onsubmit = e => {
                e.preventDefault();
                editableInputs.forEach(i => originalValues[i.name] = i.value);
                editableInputs.forEach(i => i.disabled = true);
                btnEditar.style.display = "flex";
                btnSalvar.style.display = "none";
                btnCancelar.style.display = "none";
                alert("Dados atualizados com sucesso!");
            };

            // Foto
            uploadImagemInput.onchange = function () {
                const file = this.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = e => imagemPerfil.src = e.target.result;
                    reader.readAsDataURL(file);
                }
            };

            btnFotoOpcoes.addEventListener("click", (e) => {
                e.stopPropagation();
                menuFoto.style.display = menuFoto.style.display === "flex" ? "none" : "flex";
            });

            opcaoAlterar.addEventListener("click", () => {
                uploadImagemInput.click();
                menuFoto.style.display = "none";
            });

            opcaoRemover.addEventListener("click", () => {
                imagemPerfil.src = "https://via.placeholder.com/150"; 
                uploadImagemInput.value = "";
                menuFoto.style.display = "none";
            });

            document.addEventListener("click", (e) => {
                if (!menuFoto.contains(e.target) && e.target !== btnFotoOpcoes) {
                     menuFoto.style.display = "none";
                }
            });
        });
    </script>
</body>
</html>